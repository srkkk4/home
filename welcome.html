<html lang="zh">
    <hand>
        <meta charset="UTF-8">
        <title>Welcome!</title>
        <style>
            body {
                background-image: url(background_.png);
                background-position: center center;
                background-repeat: no-repeat;
                background-attachment:fixed;
                background-size:cover;
                background-color: #464646;
            }
            * {
                margin: 0;
                padding: 0;
                vertical-align: top;
            }
            button{
                border: none;
            }
            input{
                outline: none;
            }
            .top{
                width: 100%;
                height: 20%;
            }
            .top .title{
                display: inline-block;
                position: relative;
                left: 50%;
                top: 50%;
                transform: translateX(-50%) translateY(-50%);
                color: #99ccff;
                font-size: 4cqw;
                font-weight: bolder;
            }
            .main{
                width: 100%;
                height: 70%;
            }
            .main .left {
                display: inline-block;
                backdrop-filter: blur(10px) brightness(90%);
                background-color: rgba(255, 255, 255, 0.3);
                border-radius: 10px;
                width: 60%;
                height: 100%;
                position: relative;
                left: 10%;
            }
            .main .right{
                display: inline-block;
                backdrop-filter: blur(10px) brightness(90%);
                background-color: rgba(255, 255, 255, 0.3);
                border-radius: 10px;
                width: 20%;
                height: 100%;
                position: relative;
                left: 10%;
            }
            .main .right .chat{
                width: 100%;
                height: 80%;
            }
            .main .right .enter{
                width: 100%;
                height: 5%;
                background-color: #99ccff;
                border-radius: 10px;
            }
            .main .right textarea{
                width: 100%;
                height: 15%;
                background-color: rgba(255, 255, 255, 0.3);
                border-radius: 10px;
                border-color: #99ccff;
                font-size: 15px;
            }
            .main .right textarea:focus{
                background-color: rgba(255, 255, 255, 0.5);
                border-color: #ffccff;
            }
        </style>
    </hand>
    <body>
        <div class="top">
            <p class="title">Ecaps' Home</p>
        </div>
        <br>
        <div class="main">
            <div class="left">
                
            </div>
            <div class="right">
                <textarea class="chat"></textarea>
                <button class="enter">
                    <p style="
                        color: #ffffff;
                        font-size: 1.25cqw;
                        resize: both;
                        font-weight: bolder;
                        text-align: center;
                        ">
                        Enter
                    </p>
                </button>
                <textarea class="input" type="text" placeholder="express Enter to send"></textarea>
            </div>
        </div>
        <script>
            var host='ws://localhost:4000';
            var ws=new WebSocket(host);
            var holderstatus=document.querySelector('.main .right textarea').placeholder;
            ws.onclose = function(){
                holderstatus="connecting...";
                var ws=WebSocket(host);
                holderstatus="express Enter to send";
            }

            function send(msg){
                ws.send('0x01'+msg);
            }

            function refresh(){
                ws.send('0x02');
            }
            setInterval('refresh()','1000');

            ws.onmessage = function(event){
                var chat=document.querySelector('.main .right .chat');
                const res=JSON.parse(event.data);
                let pas = "";
                for (line of res){
                    pas = pas + line + '\n========================\n';
                }
                chat.innerHTML=pas;
            }

            var button=document.querySelector('.main .right .enter');
            button.onclick = function(){
                var typing=document.querySelector('.main .right .input').value;
                send(typing);
                console.log('sent:\n'+typing);
            }

            window.onbeforeunload = function(){
                ws.close();
            }
        </script>
    </body>
</html>